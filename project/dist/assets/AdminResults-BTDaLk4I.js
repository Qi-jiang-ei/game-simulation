import{c as R,a as S,r as d,u as E,j as e,R as j}from"./index-Cmd-lEEZ.js";import{E as _,T as D}from"./trash-2-C02IjRkm.js";import{F as $,H as O,X as U,Y as F,I as J,J as z,K as M}from"./LineChart-CpvEtXHj.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=R("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),f=S("https://nseasbkxgemrpwymkfwz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zZWFzYmt4Z2VtcnB3eW1rZnd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2MzQ4ODQsImV4cCI6MjA1ODIxMDg4NH0.6hlmrN3w-m9v6WNjkRLYfDItTBsIS8LbNwwNSMET8Sw"),X=()=>{var p;const[x,h]=d.useState([]),[u,N]=d.useState(!0),[r,m]=d.useState(null),{addToast:i}=E();d.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:t,error:s}=await f.from("simulation_results").select(`
          *,
          game_models (
            name,
            type,
            config
          )
        `).order("created_at",{ascending:!1});if(s)throw s;h(t||[])}catch(t){console.error("获取仿真结果失败:",t),i({type:"error",message:"获取仿真结果失败",duration:3e3})}finally{N(!1)}},w=async t=>{if(confirm("确定要删除这个仿真结果吗？"))try{const{error:s}=await f.from("simulation_results").delete().eq("id",t);if(s)throw s;h(x.filter(a=>a.id!==t)),(r==null?void 0:r.id)===t&&m(null),i({type:"success",message:"删除成功",duration:3e3})}catch(s){console.error("删除仿真结果失败:",s),i({type:"error",message:"删除失败",duration:3e3})}},v=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/[/]/g,""),k=t=>{const s=t.game_models.config.players;let a="回合,";return s.forEach(n=>{a+=`${n.name}策略,${n.name}收益,`}),a=a.slice(0,-1)+`
`,t.results.forEach(n=>{a+=`${n.step+1},`,s.forEach(l=>{a+=`${n.playerChoices[l.id]},${n.payoffs[l.id]},`}),a=a.slice(0,-1)+`
`}),a},C=t=>{try{const s=v(t.created_at),a=`${t.game_models.name}_${s}`,n=k(t),l=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8"}),y=URL.createObjectURL(l),c=document.createElement("a");c.href=y,c.download=`${a}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(y);const I=JSON.stringify(t.results,null,2),L=new Blob([I],{type:"application/json"}),g=URL.createObjectURL(L),o=document.createElement("a");o.href=g,o.download=`${a}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(g),i({type:"success",message:"导出成功",duration:3e3})}catch(s){console.error("导出失败:",s),i({type:"error",message:"导出失败",duration:3e3})}};return u?e.jsx("div",{className:"text-center py-8",children:"加载中..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"仿真结果管理"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"模型"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"类型"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"仿真时间"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.game_models.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:t.game_models.type})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-900 mr-4",onClick:()=>m(t),title:"查看详情",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-green-600 hover:text-green-900 mr-4",onClick:()=>C(t),title:"导出数据",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-red-600 hover:text-red-900",onClick:()=>w(t.id),title:"删除",children:e.jsx(D,{className:"w-4 h-4"})})]})]},t.id))})]})})]}),r&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:[r.game_models.name," - 仿真结果详情"]}),e.jsx("button",{onClick:()=>m(null),className:"text-gray-500 hover:text-gray-700",children:"关闭"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{width:800,height:400,data:r.results,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"step"}),e.jsx(F,{}),e.jsx(J,{}),e.jsx(z,{}),Object.keys(((p=r.results[0])==null?void 0:p.payoffs)||{}).map((t,s)=>e.jsx(M,{type:"monotone",dataKey:`payoffs.${t}`,name:`玩家${t}收益`,stroke:`#${Math.floor(Math.random()*16777215).toString(16)}`},t))]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"原始数据"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"回合"}),r.game_models.config.players.map(t=>e.jsxs(j.Fragment,{children:[e.jsxs("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:[t.name,"策略"]}),e.jsxs("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:[t.name,"收益"]})]},t.id))]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:r.results.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.step+1}),r.game_models.config.players.map(a=>e.jsxs(j.Fragment,{children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.playerChoices[a.id]}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.payoffs[a.id]})]},a.id))]},s))})]})})]})]})]})};export{X as AdminResults};
