import{c as N,a as v,r as i,j as e}from"./index-Cmd-lEEZ.js";import{P as w,M}from"./ModelEditor-BhoIoHaI.js";import{E as I,T as C}from"./trash-2-C02IjRkm.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=N("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),c=v("https://nseasbkxgemrpwymkfwz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zZWFzYmt4Z2VtcnB3eW1rZnd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2MzQ4ODQsImV4cCI6MjA1ODIxMDg4NH0.6hlmrN3w-m9v6WNjkRLYfDItTBsIS8LbNwwNSMET8Sw"),z=()=>{const[x,m]=i.useState([]),[b,f]=i.useState(!0),[h,d]=i.useState(null),[j,o]=i.useState(!1),[a,n]=i.useState(null);i.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:s,error:t}=await c.from("game_models").select("*").order("created_at",{ascending:!1});if(t)throw t;m(s||[])}catch(s){console.error("获取模型列表失败:",s),alert("获取模型列表失败")}finally{f(!1)}},u=async s=>{if(confirm("确定要删除这个模型吗？"))try{const{error:t}=await c.from("game_models").delete().eq("id",s);if(t)throw t;m(x.filter(r=>r.id!==s))}catch(t){console.error("删除模型失败:",t),alert("删除模型失败")}},p=s=>{const t={id:s.id,name:s.name,type:s.type,description:s.description,players:s.config.players,payoffMatrix:s.config.payoffMatrix,isClassic:!1};d(t)},y=async s=>{try{const{data:t}=await c.auth.getUser();if(!t.user)throw new Error("用户未登录");const r={name:s.name,type:s.type,description:s.description,config:{players:s.players,payoffMatrix:s.payoffMatrix},user_id:t.user.id};let l;if(s.id&&!s.isClassic?{error:l}=await c.from("game_models").update(r).eq("id",s.id):{error:l}=await c.from("game_models").insert(r),l)throw l;await g(),d(null),o(!1)}catch(t){console.error("保存模型失败:",t),alert("保存模型失败")}};return b?e.jsx("div",{className:"text-center py-8",children:"加载中..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"博弈模型管理"}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[e.jsx(w,{className:"w-4 h-4"}),"新建模型"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:x.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(k,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(C,{className:"w-4 h-4"})})]})]}),e.jsx("span",{className:"inline-block px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 mb-2",children:s.type}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["创建时间：",new Date(s.created_at).toLocaleString()]})]},s.id))})]}),(h||j)&&e.jsx(M,{model:h||void 0,onSave:y,onCancel:()=>{d(null),o(!1)}}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:a.name}),e.jsx("button",{onClick:()=>n(null),className:"text-gray-500 hover:text-gray-700",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"博弈类型"}),e.jsx("p",{className:"text-gray-600",children:a.type})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"模型描述"}),e.jsx("p",{className:"text-gray-600",children:a.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"参与者"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.config.players.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold mb-2",children:s.name}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"可选策略："}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-600",children:s.strategies.map(t=>e.jsx("li",{children:t},t))})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-2",children:"收益矩阵"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-200 px-4 py-2 bg-gray-50",children:"策略组合"}),a.config.players.map(s=>e.jsxs("th",{className:"border border-gray-200 px-4 py-2 bg-gray-50",children:[s.name,"收益"]},s.id))]})}),e.jsx("tbody",{children:Object.entries(a.config.payoffMatrix).map(([s,t])=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-200 px-4 py-2",children:s}),t.map((r,l)=>e.jsx("td",{className:"border border-gray-200 px-4 py-2 text-center",children:r},l))]},s))})]})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>n(null),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"关闭"}),e.jsx("button",{onClick:()=>{p(a),n(null)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"编辑模型"})]})]})})})]})};export{z as AdminModels};
